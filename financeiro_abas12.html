<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Financeiro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        

        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        
        .tab.income.active {
            color: #10b981;
            border-bottom-color: #10b981;
        }
        
        .tab.expense.active {
            color: #f5576c;
            border-bottom-color: #f5576c;
        }
        
        .tab.stats.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab.savings.active {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .balance-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .balance-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .balance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .balance-card.income {
            border-left: 4px solid #10b981;
        }
        
        .balance-card.expense {
            border-left: 4px solid #f5576c;
        }
        
        .balance-card.balance {
            border-left: 4px solid #667eea;
        }
        
        .balance-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }
        
        .balance-amount {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }
        
        .balance-card.income .balance-amount {
            color: #10b981;
        }
        
        .balance-card.expense .balance-amount {
            color: #f5576c;
        }
        
        .balance-card.balance .balance-amount {
            color: #667eea;
        }
        
        .balance-card.savings {
            border-left: 4px solid #8b5cf6;
        }
        
        .balance-card.savings .balance-amount {
            color: #8b5cf6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .section-title.income {
            color: #10b981;
            border-bottom-color: #10b981;
        }
        
        .section-title.expense {
            color: #f5576c;
            border-bottom-color: #f5576c;
        }
        
        .section-title.savings {
            color: #8b5cf6;
            border-bottom-color: #8b5cf6;
        }
        
        .form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form.income input:focus, .form.income select:focus {
            border-color: #10b981;
        }
        
        .form.expense input:focus, .form.expense select:focus {
            border-color: #f5576c;
        }
        
        .form.savings input:focus, .form.savings select:focus {
            border-color: #8b5cf6;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-weight: 500;
        }
        
        .btn.income {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn.expense {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            color: white;
        }
        
        .btn.savings {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .transactions-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: hidden;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title-small {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }
        
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .general-filter-section {
            background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .filter-header h3 {
            color: #333;
            font-size: 1.2em;
            margin: 0;
        }
        
        .period-info {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            color: #666;
            font-size: 0.9em;
            border: 1px solid #e0e0e0;
        }
        
        .general-month-filter {
            width: 100%;
            max-width: 300px;
            padding: 12px 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .general-month-filter:focus {
            outline: none;
            border-color: #4c5fd5;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .month-filter {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        
        .month-filter:focus {
            outline: none;
            border-color: #667eea;
        }
        

        
        .transaction-count {
            background: #f0f0f0;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #666;
        }
        
        .transactions-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .transaction {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .transaction:hover {
            transform: translateX(3px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .transaction.info {
            flex: 1;
        }
        
        .transaction-description {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .transaction-date {
            color: #666;
            font-size: 0.9em;
        }
        
        .transaction-amount {
            font-size: 1.2em;
            font-weight: bold;
            margin-left: 20px;
        }
        
        .transaction-amount.income {
            color: #10b981;
        }
        
        .transaction-amount.expense {
            color: #f5576c;
        }
        
        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.2s;
        }
        
        .delete-btn:hover {
            background: #cc0000;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
        }
        
        .chart-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-wrapper {
            height: 250px;
        }
        
        /* Estilos para metas de guarda */
        .savings-goal {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .savings-goal:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .savings-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .savings-info {
            flex: 1;
        }
        
        .savings-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .savings-deadline {
            color: #666;
            font-size: 0.9em;
        }
        
        .savings-progress {
            margin-bottom: 15px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .progress-bar {
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .savings-actions {
            border-top: 1px solid #e0e0e0;
            padding-top: 15px;
        }
        
        .contribution-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .contribution-form input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .btn-small {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .contribution-btn {
            background: #10b981;
            color: white;
        }
        
        .withdraw-btn {
            background: #f5576c;
            color: white;
        }
        
        .btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .balance-cards {
                grid-template-columns: 1fr;
            }
            
            .contribution-form {
                flex-direction: column;
                gap: 8px;
            }
            
            .contribution-form input {
                width: 100%;
            }
            
            .btn-small {
                width: 100%;
            }
        }
        
        /* Estilos para login */
        .login-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .login-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
        }
        
        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .google-login-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            border: 2px solid #4285f4;
            background: white;
            border-radius: 8px;
            color: #4285f4;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .google-login-btn:hover {
            background: #4285f4;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        
        .user-name {
            font-size: 14px;
            color: #333;
        }
        
        .logout-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.2s;
        }
        
        .logout-btn:hover {
            background: #f0f0f0;
        }
        
        .sync-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .sync-status.synced {
            background: #d1fae5;
            color: #065f46;
        }
        
        .sync-status.syncing {
            background: #fef3c7;
            color: #92400e;
        }
        
        .sync-status.error {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="user-info" id="user-info" style="display: none;">
                <img class="user-avatar" id="user-avatar" src="" alt="">
                <span class="user-name" id="user-name"></span>
                <span class="sync-status synced" id="sync-status">‚úÖ Sincronizado</span>
                <button class="logout-btn" onclick="handleLogout()">Sair</button>
            </div>
            <h1>üí∞ Financeiro</h1>
            <p>Controle simples e eficiente de suas finan√ßas</p>
        </div>
        
        <div class="balance-cards">
            <div class="balance-card income">
                <div class="balance-label">üíµ Total Ganhos</div>
                <div class="balance-amount" id="total-income">R$ 0.00</div>
            </div>
            <div class="balance-card expense">
                <div class="balance-label">üí∏ Total Gastos</div>
                <div class="balance-amount" id="total-expense">R$ 0.00</div>
            </div>
            <div class="balance-card balance">
                <div class="balance-label">üè¶ Saldo</div>
                <div class="balance-amount" id="total-balance">R$ 0.00</div>
            </div>
        </div>
        
        <!-- Filtro Geral -->
        <div class="general-filter-section">
            <div class="filter-header">
                <h3>üìÖ Filtro Geral</h3>
                <div class="period-info" id="period-info">Todos os per√≠odos</div>
            </div>
            <select class="general-month-filter" id="general-month-filter" onchange="applyGeneralFilter()">
                <option value="">Todos os meses</option>
            </select>
        </div>
        
        <div class="tabs">
            <button class="tab income active" onclick="showTab('income')">üíµ Ganhos</button>
            <button class="tab expense" onclick="showTab('expense')">üí∏ Gastos</button>
            <button class="tab savings" onclick="showTab('savings')">üè¶ Guardas</button>
            <button class="tab stats" onclick="showTab('stats')">üìä Estat√≠sticas</button>
        </div>
        
        <!-- Aba de Ganhos -->
        <div id="income-tab" class="tab-content active">
            <div class="form income">
                <h3 class="section-title income">‚ûï Adicionar Ganho</h3>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="income-description" placeholder="Ex: Sal√°rio, Freelancer...">
                </div>
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="income-amount" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="income-date">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="income-category">
                        <option value="salario">üíº Sal√°rio</option>
                        <option value="freelancer">üíª Freelancer</option>
                        <option value="investimento">üìà Investimento</option>
                        <option value="extra">‚≠ê Extra</option>
                        <option value="outros">üì¶ Outros</option>
                    </select>
                </div>
                <button class="btn income" onclick="addIncome()">‚úÖ Adicionar Ganho</button>
            </div>
            
            <div class="transactions-section">
                <div class="section-header">
                    <h4 class="section-title-small">üìã Transa√ß√µes de Ganhos</h4>
                <div class="filter-controls">
                    <select class="month-filter" id="income-month-filter" onchange="filterTransactions('income')">
                        <option value="">Todos os meses</option>
                    </select>
                    <span class="transaction-count" id="income-count">0 itens</span>
                </div>
                </div>
                <div class="transactions-list" id="income-transactions">
                    <div class="empty-state">Nenhum ganho registrado ainda</div>
                </div>
            </div>
        </div>
        
        <!-- Aba de Gastos -->
        <div id="expense-tab" class="tab-content">
            <div class="form expense">
                <h3 class="section-title expense">‚ûï Adicionar Gasto</h3>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="expense-description" placeholder="Ex: Supermercado, Aluguel...">
                </div>
                <div class="form-group">
                    <label>Valor (R$)</label>
                    <input type="number" id="expense-amount" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="expense-date">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="expense-category">
                        <option value="alimentacao">üçî Alimenta√ß√£o</option>
                        <option value="moradia">üè† Moradia</option>
                        <option value="transporte">üöó Transporte</option>
                        <option value="saude">üè• Sa√∫de</option>
                        <option value="educacao">üìö Educa√ß√£o</option>
                        <option value="lazer">üìö Lazer e Cultura</option>
                        <option value="extras">‚ö° Gastos Extras</option>
                        <option value="cartao">üí≥ Gastos com Cart√£o</option>
                        <option value="outros">üì¶ Outros</option>
                    </select>
                </div>
                <button class="btn expense" onclick="addExpense()">‚úÖ Adicionar Gasto</button>
            </div>
            
            <div class="transactions-section">
                <div class="section-header">
                    <h4 class="section-title-small">üìã Transa√ß√µes de Gastos</h4>
                <div class="filter-controls">
                    <select class="month-filter" id="expense-month-filter" onchange="filterTransactions('expense')">
                        <option value="">Todos os meses</option>
                    </select>
                    <span class="transaction-count" id="expense-count">0 itens</span>
                </div>
                </div>
                <div class="transactions-list" id="expense-transactions">
                    <div class="empty-state">Nenhum gasto registrado ainda</div>
                </div>
            </div>
        </div>
        
        <!-- Aba de Guardas -->
        <div id="savings-tab" class="tab-content">
            <!-- Total Guardado -->
            <div class="balance-cards">
                <div class="balance-card savings">
                    <div class="balance-label">üè¶ Total Guardado</div>
                    <div class="balance-amount" id="total-saved">R$ 0.00</div>
                </div>
                <div class="balance-card savings">
                    <div class="balance-label">üéØ Total das Metas</div>
                    <div class="balance-amount" id="total-target">R$ 0.00</div>
                </div>
                <div class="balance-card savings">
                    <div class="balance-label">üìä Progresso Geral</div>
                    <div class="balance-amount" id="overall-progress">0%</div>
                </div>
            </div>
            
            <div class="form savings">
                <h3 class="section-title savings">üè¶ Nova Meta de Guarda</h3>
                <div class="form-group">
                    <label>Nome da Meta</label>
                    <input type="text" id="savings-name" placeholder="Ex: Fundo de Emerg√™ncia, Viagem...">
                </div>
                <div class="form-group">
                    <label>Valor Meta (R$)</label>
                    <input type="number" id="savings-target" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Valor Inicial (R$)</label>
                    <input type="number" id="savings-current" step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Data Limite</label>
                    <input type="date" id="savings-deadline">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="savings-category">
                        <option value="emergencia">üö® Emerg√™ncia</option>
                        <option value="viagem">‚úàÔ∏è Viagem</option>
                        <option value="imovel">üè† Im√≥vel</option>
                        <option value="educacao">üìö Educa√ß√£o</option>
                        <option value="investimento">üìà Investimento</option>
                        <option value="lazer">üéØ Lazer</option>
                        <option value="outros">üì¶ Outros</option>
                    </select>
                </div>
                <button class="btn savings" onclick="addSavings()">‚úÖ Criar Meta</button>
            </div>
            
            <div class="transactions-section">
                <div class="section-header">
                    <h4 class="section-title-small">üéØ Metas de Guarda</h4>
                    <div class="filter-controls">
                        <span class="transaction-count" id="savings-count">0 metas</span>
                    </div>
                </div>
                <div class="transactions-list" id="savings-transactions">
                    <div class="empty-state">Nenhuma meta de guarda criada ainda</div>
                </div>
            </div>
        </div>
        
        <!-- Aba de Estat√≠sticas -->
        <div id="stats-tab" class="tab-content">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">üìà Evolu√ß√£o Mensal</div>
                    <div class="chart-wrapper">
                        <canvas id="evolution-chart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üíµ Ganhos por Categoria</div>
                    <div class="chart-wrapper">
                        <canvas id="income-category-chart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üí∏ Gastos por Categoria</div>
                    <div class="chart-wrapper">
                        <canvas id="expense-category-chart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üè¶ Fluxo Financeiro</div>
                    <div class="chart-wrapper">
                        <canvas id="cashflow-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login Modal -->
    <div class="login-container" id="login-container">
        <div class="login-box">
            <h2 class="login-title">üîê Login Necess√°rio</h2>
            <p class="login-subtitle">Fa√ßa login com Google para acessar seus dados financeiros</p>
            <button class="google-login-btn" onclick="handleLogin()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Entrar com Google
            </button>
        </div>
    </div>

    <script>
        // Configura√ß√£o Google Sheets
        const API_KEY = 'AIzaSyAD5tyS4sy62B7ssuNJ_k8XW87u90sWTpk'; // API Key para Google Sheets
        const CLIENT_ID = '596035281552-naclvh0p7l3atg7tsk0l01ih0vk13g0n.apps.googleusercontent.com'; // Client ID para autentica√ß√£o OAuth
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SPREADSHEET_ID = '1OaOUNdkYvQYzdAAx_NKyL6evcF2oCKvTEm3ZwJKH6rU';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
        
        // Vari√°veis de dados
        let transactions = [];
        let savingsGoals = [];
        let charts = {};
        let currentIncomeFilter = '';
        let currentExpenseFilter = '';
        let generalMonthFilter = '';
        
        // Vari√°veis de autentica√ß√£o
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let isSignedIn = false;
        
        // Inicializa√ß√£o Google APIs
        function gapiLoaded() {
            gapi.load('client', initializeGapi);
        }
        
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                redirect_uri: window.location.href,
                callback: ''
            });
            gisInited = true;
        }
        
        function initializeGapi() {
            gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            }).then(function() {
                gapiInited = true;
            });
        }
        
        // Fun√ß√µes de autentica√ß√£o
        function handleLogin() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    throw (resp);
                }
                isSignedIn = true;
                await loadUserData();
                hideLogin();
                showUserInfo();
                initializeApp();
            };
            
            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }
        
        function handleLogout() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                isSignedIn = false;
                showLogin();
                hideUserInfo();
            }
        }
        
        // Controles de UI
        function showLogin() {
            document.getElementById('login-container').style.display = 'flex';
        }
        
        function hideLogin() {
            document.getElementById('login-container').style.display = 'none';
        }
        
        function showUserInfo() {
            document.getElementById('user-info').style.display = 'flex';
            const currentUser = google.accounts.oauth2.getGrantedFirstScope();
            // Aqui voc√™ pode obter informa√ß√µes do usu√°rio se necess√°rio
        }
        
        function hideUserInfo() {
            document.getElementById('user-info').style.display = 'none';
        }
        
        // Carregar dados do Google Sheets
        async function loadUserData() {
            try {
                updateSyncStatus('syncing');
                
                // Carregar transa√ß√µes
                const transactionsResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Transa√ß√µes!A:G'
                });
                
                transactions = [];
                const rows = transactionsResponse.result.values;
                if (rows.length > 1) {
                    const headers = rows[0];
                    for (let i = 1; i < rows.length; i++) {
                        const row = rows[i];
                        if (row.length > 0) {
                            transactions.push({
                                id: parseInt(row[0]),
                                type: row[1],
                                description: row[2],
                                amount: parseFloat(row[3]),
                                date: row[4],
                                category: row[5],
                                timestamp: row[6]
                            });
                        }
                    }
                }
                
                // Carregar metas
                const savingsResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Metas!A:H'
                });
                
                savingsGoals = [];
                const savingsRows = savingsResponse.result.values;
                if (savingsRows.length > 1) {
                    const headers = savingsRows[0];
                    for (let i = 1; i < savingsRows.length; i++) {
                        const row = savingsRows[i];
                        if (row.length > 0) {
                            savingsGoals.push({
                                id: parseInt(row[0]),
                                name: row[1],
                                target: parseFloat(row[2]),
                                current: parseFloat(row[3]),
                                deadline: row[4],
                                category: row[5],
                                createdAt: row[6],
                                contributionHistory: row[7] ? JSON.parse(row[7]) : []
                            });
                        }
                    }
                }
                
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                updateSyncStatus('error');
            }
        }
        
        // Salvar dados no Google Sheets
        async function saveTransactions() {
            if (!isSignedIn) return;
            
            try {
                updateSyncStatus('syncing');
                
                const values = [
                    ['id', 'type', 'description', 'amount', 'date', 'category', 'timestamp'],
                    ...transactions.map(t => [
                        t.id.toString(),
                        t.type,
                        t.description,
                        t.amount.toString(),
                        t.date,
                        t.category,
                        t.timestamp
                    ])
                ];
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Transa√ß√µes!A:G',
                    valueInputOption: 'USER_ENTERED',
                    resource: { values }
                });
                
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Erro ao salvar transa√ß√µes:', error);
                updateSyncStatus('error');
            }
        }
        
        async function saveSavingsGoals() {
            if (!isSignedIn) return;
            
            try {
                updateSyncStatus('syncing');
                
                const values = [
                    ['id', 'name', 'target', 'current', 'deadline', 'category', 'createdAt', 'contributionHistory'],
                    ...savingsGoals.map(g => [
                        g.id.toString(),
                        g.name,
                        g.target.toString(),
                        g.current.toString(),
                        g.deadline,
                        g.category,
                        g.createdAt,
                        JSON.stringify(g.contributionHistory)
                    ])
                ];
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: 'Metas!A:H',
                    valueInputOption: 'USER_ENTERED',
                    resource: { values }
                });
                
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Erro ao salvar metas:', error);
                updateSyncStatus('error');
            }
        }
        
        function updateSyncStatus(status) {
            const statusElement = document.getElementById('sync-status');
            statusElement.className = `sync-status ${status}`;
            
            switch(status) {
                case 'synced':
                    statusElement.textContent = '‚úÖ Sincronizado';
                    break;
                case 'syncing':
                    statusElement.textContent = '‚è≥ Sincronizando...';
                    break;
                case 'error':
                    statusElement.textContent = '‚ùå Erro na sincroniza√ß√£o';
                    break;
            }
        }
        
        // Inicializar
        function initializeApp() {
            // Definir data atual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('income-date').value = today;
            document.getElementById('expense-date').value = today;
            document.getElementById('savings-deadline').value = today;
            
            // Renderizar
            updateBalanceCards();
            updateSavingsCards();
            renderTransactions();
            renderSavingsGoals();
            updateCharts();
        }
        
        // Inicializa√ß√£o principal
        window.onload = function() {
            // Verificar se j√° est√° logado
            if (gapi.client.getToken() !== null) {
                isSignedIn = true;
                loadUserData().then(() => {
                    hideLogin();
                    showUserInfo();
                    initializeApp();
                });
            } else {
                showLogin();
            }
        };
        
        // Mudar aba
        function showTab(tab) {
            // Remover active de todas
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(c => {
                c.classList.remove('active');
            });
            
            // Adicionar active na selecionada
            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
            
            // Renderizar metas de guarda se for aba de savings
            if (tab === 'savings') {
                updateSavingsCards();
                renderSavingsGoals();
            }
            
            // Atualizar gr√°ficos se for aba de estat√≠sticas
            if (tab === 'stats') {
                setTimeout(() => updateCharts(), 200);
            }
        }
        
        // Adicionar ganho
        function addIncome() {
            const description = document.getElementById('income-description').value;
            const amount = parseFloat(document.getElementById('income-amount').value);
            const date = document.getElementById('income-date').value;
            const category = document.getElementById('income-category').value;
            
            if (!description || !amount || !date) {
                alert('Preencha todos os campos!');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                type: 'income',
                description,
                amount,
                date,
                category,
                timestamp: new Date().toISOString()
            };
            
            transactions.unshift(transaction);
            saveTransactions();
            
            // Limpar formul√°rio
            document.getElementById('income-description').value = '';
            document.getElementById('income-amount').value = '';
            document.getElementById('income-date').value = new Date().toISOString().split('T')[0];
            
            // Atualizar
            updateBalanceCards();
            populateMonthFilters();
            renderTransactions();
            updateCharts();
            
            // Feedback
            showSuccess('Ganho adicionado com sucesso!');
        }
        
        // Adicionar gasto
        function addExpense() {
            const description = document.getElementById('expense-description').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            
            if (!description || !amount || !date) {
                alert('Preencha todos os campos!');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                type: 'expense',
                description,
                amount,
                date,
                category,
                timestamp: new Date().toISOString()
            };
            
            transactions.unshift(transaction);
            saveTransactions();
            
            // Limpar formul√°rio
            document.getElementById('expense-description').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            
            // Atualizar
            updateBalanceCards();
            populateMonthFilters();
            renderTransactions();
            updateCharts();
            
            // Feedback
            showSuccess('Gasto adicionado com sucesso!');
        }
        
        // Adicionar meta de guarda
        function addSavings() {
            const name = document.getElementById('savings-name').value;
            const target = parseFloat(document.getElementById('savings-target').value);
            const current = parseFloat(document.getElementById('savings-current').value);
            const deadline = document.getElementById('savings-deadline').value;
            const category = document.getElementById('savings-category').value;
            
            if (!name || !target || !deadline) {
                alert('Preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            const savingsGoal = {
                id: Date.now(),
                name,
                target,
                current: current || 0,
                deadline,
                category,
                createdAt: new Date().toISOString(),
                contributionHistory: []
            };
            
            savingsGoals.unshift(savingsGoal);
            saveSavingsGoals();
            
            // Limpar formul√°rio
            document.getElementById('savings-name').value = '';
            document.getElementById('savings-target').value = '';
            document.getElementById('savings-current').value = '';
            document.getElementById('savings-deadline').value = '';
            
            // Atualizar
            updateSavingsCards();
            renderSavingsGoals();
            
            // Feedback
            showSuccess('Meta de guarda criada com sucesso!');
        }
        
        // Excluir transa√ß√£o
        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateBalanceCards();
                populateMonthFilters();
                renderTransactions();
                updateCharts();
            }
        }
        
        // Salvar no localStorage
        function saveTransactions() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }
        
        function saveSavingsGoals() {
            localStorage.setItem('savingsGoals', JSON.stringify(savingsGoals));
        }
        
        // Aplicar filtro geral
        function applyGeneralFilter() {
            generalMonthFilter = document.getElementById('general-month-filter').value;
            
            // Atualizar informa√ß√µes do per√≠odo
            const periodInfo = document.getElementById('period-info');
            if (generalMonthFilter) {
                const [year, month] = generalMonthFilter.split('-');
                const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                periodInfo.textContent = `${months[parseInt(month) - 1]} ${year}`;
            } else {
                periodInfo.textContent = 'Todos os per√≠odos';
            }
            
            // Atualizar todos os dados
            updateBalanceCards();
            renderTransactions();
            updateCharts();
            updateIndividualFilters();
        }
        
        // Atualizar filtros individuais para sincronizar com o geral
        function updateIndividualFilters() {
            const incomeFilter = document.getElementById('income-month-filter');
            const expenseFilter = document.getElementById('expense-month-filter');
            
            if (incomeFilter) {
                incomeFilter.value = generalMonthFilter;
            }
            
            if (expenseFilter) {
                expenseFilter.value = generalMonthFilter;
            }
        }
        
        // Atualizar cards de saldo
        function updateBalanceCards() {
            let filteredTransactions = transactions;
            
            // Aplicar filtro geral se houver
            if (generalMonthFilter) {
                const [year, month] = generalMonthFilter.split('-');
                filteredTransactions = transactions.filter(t => {
                    const [tYear, tMonth] = t.date.split('-');
                    return parseInt(tYear) === parseInt(year) && 
                           parseInt(tMonth) === parseInt(month);
                });
            }
            
            const incomes = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenses = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = incomes - expenses;
            
            document.getElementById('total-income').textContent = `R$ ${incomes.toFixed(2)}`;
            document.getElementById('total-expense').textContent = `R$ ${expenses.toFixed(2)}`;
            document.getElementById('total-balance').textContent = `R$ ${balance.toFixed(2)}`;
        }
        
        // Atualizar cards de savings
        function updateSavingsCards() {
            const totalSaved = savingsGoals.reduce((sum, goal) => sum + goal.current, 0);
            const totalTarget = savingsGoals.reduce((sum, goal) => sum + goal.target, 0);
            const overallProgress = totalTarget > 0 ? (totalSaved / totalTarget) * 100 : 0;
            
            document.getElementById('total-saved').textContent = `R$ ${totalSaved.toFixed(2)}`;
            document.getElementById('total-target').textContent = `R$ ${totalTarget.toFixed(2)}`;
            document.getElementById('overall-progress').textContent = `${overallProgress.toFixed(1)}%`;
        }
        
        // Filtrar transa√ß√µes por m√™s
        function filterTransactions(type) {
            if (type === 'income') {
                currentIncomeFilter = document.getElementById('income-month-filter').value;
            } else {
                currentExpenseFilter = document.getElementById('expense-month-filter').value;
            }
            renderTransactions();
        }
        
        // Obter transa√ß√µes filtradas
        function getFilteredTransactions(type) {
            // Usar filtro geral prioritariamente
            const filter = generalMonthFilter || (type === 'income' ? currentIncomeFilter : currentExpenseFilter);
            
            if (!filter) {
                return transactions.filter(t => t.type === type);
            }
            
            const [year, month] = filter.split('-');
            return transactions.filter(t => {
                if (t.type !== type) return false;
                const [tYear, tMonth] = t.date.split('-');
                return parseInt(tYear) === parseInt(year) && 
                       parseInt(tMonth) === parseInt(month);
            });
        }
        
        // Popular filtros de m√™s
        function populateMonthFilters() {
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            // Obter meses usados APENAS se houver transa√ß√µes
            const usedMonths = new Set();
            transactions.forEach(transaction => {
                const [year, month] = transaction.date.split('-');
                const monthYear = `${year}-${String(month).padStart(2, '0')}`;
                usedMonths.add(monthYear);
            });
            
            // S√≥ adicionar m√™s atual se houver transa√ß√µes OU se n√£o houver nenhum m√™s
            if (usedMonths.size === 0) {
                const currentDate = new Date();
                const currentMonthYear = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                usedMonths.add(currentMonthYear);
            }
            
            // Popular filtro GERAL primeiro
            const generalFilter = document.getElementById('general-month-filter');
            if (generalFilter) {
                const currentValue = generalFilter.value;
                generalFilter.innerHTML = '<option value="">Todos os meses</option>';
                
                Array.from(usedMonths).sort().reverse().forEach(monthYear => {
                    const [year, month] = monthYear.split('-');
                    const option = document.createElement('option');
                    option.value = monthYear;
                    option.textContent = `${months[parseInt(month) - 1]} ${year}`;
                    generalFilter.appendChild(option);
                });
                
                // Manter sele√ß√£o anterior se ainda for v√°lida
                if (currentValue && Array.from(usedMonths).includes(currentValue)) {
                    generalFilter.value = currentValue;
                }
            }
            
            // Popular select de ganhos
            const incomeFilter = document.getElementById('income-month-filter');
            if (incomeFilter) {
                const currentValueIncome = incomeFilter.value;
                incomeFilter.innerHTML = '<option value="">Todos os meses</option>';
                
                Array.from(usedMonths).sort().reverse().forEach(monthYear => {
                    const [year, month] = monthYear.split('-');
                    const option = document.createElement('option');
                    option.value = monthYear;
                    option.textContent = `${months[parseInt(month) - 1]} ${year}`;
                    incomeFilter.appendChild(option);
                });
                
                // Manter sele√ß√£o anterior se ainda for v√°lida
                if (currentValueIncome && Array.from(usedMonths).includes(currentValueIncome)) {
                    incomeFilter.value = currentValueIncome;
                }
            }
            
            // Popular select de gastos
            const expenseFilter = document.getElementById('expense-month-filter');
            if (expenseFilter) {
                const currentValueExpense = expenseFilter.value;
                expenseFilter.innerHTML = '<option value="">Todos os meses</option>';
                
                Array.from(usedMonths).sort().reverse().forEach(monthYear => {
                    const [year, month] = monthYear.split('-');
                    const option = document.createElement('option');
                    option.value = monthYear;
                    option.textContent = `${months[parseInt(month) - 1]} ${year}`;
                    expenseFilter.appendChild(option);
                });
                
                // Manter sele√ß√£o anterior se ainda for v√°lida
                if (currentValueExpense && Array.from(usedMonths).includes(currentValueExpense)) {
                    expenseFilter.value = currentValueExpense;
                }
            }
        }
        
        // Renderizar transa√ß√µes
        function renderTransactions() {
            const incomeTransactions = getFilteredTransactions('income');
            const expenseTransactions = getFilteredTransactions('expense');
            
            // Renderizar ganhos
            const incomeList = document.getElementById('income-transactions');
            document.getElementById('income-count').textContent = `${incomeTransactions.length} itens`;
            
            if (incomeTransactions.length === 0) {
                incomeList.innerHTML = '<div class="empty-state">Nenhum ganho encontrado para este per√≠odo</div>';
            } else {
                incomeList.innerHTML = incomeTransactions
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(transaction => `
                        <div class="transaction">
                            <div class="transaction.info">
                                <div class="transaction-description">${getCategoryIcon(transaction.category)} ${transaction.description}</div>
                                <div class="transaction-date">${new Date(transaction.date).toLocaleDateString('pt-BR')}</div>
                            </div>
                            <div class="transaction-amount income">+R$ ${transaction.amount.toFixed(2)}</div>
                            <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                        </div>
                    `).join('');
            }
            
            // Renderizar gastos
            const expenseList = document.getElementById('expense-transactions');
            document.getElementById('expense-count').textContent = `${expenseTransactions.length} itens`;
            
            if (expenseTransactions.length === 0) {
                expenseList.innerHTML = '<div class="empty-state">Nenhum gasto encontrado para este per√≠odo</div>';
            } else {
                expenseList.innerHTML = expenseTransactions
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(transaction => `
                        <div class="transaction">
                            <div class="transaction.info">
                                <div class="transaction-description">${getCategoryIcon(transaction.category)} ${transaction.description}</div>
                                <div class="transaction-date">${new Date(transaction.date).toLocaleDateString('pt-BR')}</div>
                            </div>
                            <div class="transaction-amount expense">-R$ ${transaction.amount.toFixed(2)}</div>
                            <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                        </div>
                    `).join('');
            }
        }
        
        // Obter √≠cone da categoria
        function getCategoryIcon(category) {
            const icons = {
                'salario': 'üíº',
                'freelancer': 'üíª',
                'investimento': 'üìà',
                'extra': '‚≠ê',
                'outros': 'üì¶',
                'alimentacao': 'üçî',
                'moradia': 'üè†',
                'transporte': 'üöó',
                'saude': 'üè•',
                'educacao': 'üìö',
                'lazer': 'üìö',
                'extras': '‚ö°',
                'cartao': 'üí≥'
            };
            return icons[category] || 'üì¶';
        }
        
        // Renderizar metas de guarda
        function renderSavingsGoals() {
            const savingsList = document.getElementById('savings-transactions');
            document.getElementById('savings-count').textContent = `${savingsGoals.length} metas`;
            
            if (savingsGoals.length === 0) {
                savingsList.innerHTML = '<div class="empty-state">Nenhuma meta de guarda criada ainda</div>';
                return;
            }
            
            savingsList.innerHTML = savingsGoals
                .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt))
                .map(goal => {
                    const percentage = (goal.current / goal.target) * 100;
                    const daysLeft = Math.ceil((new Date(goal.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                    const statusColor = percentage >= 100 ? '#10b981' : percentage >= 50 ? '#f59e0b' : '#ef4444';
                    
                    return `
                        <div class="savings-goal">
                            <div class="savings-header">
                                <div class="savings-info">
                                    <div class="savings-name">${getSavingsCategoryIcon(goal.category)} ${goal.name}</div>
                                    <div class="savings-deadline">üìÖ Prazo: ${new Date(goal.deadline).toLocaleDateString('pt-BR')} (${daysLeft > 0 ? daysLeft + ' dias' : 'Vencido'})</div>
                                </div>
                                <button class="delete-btn" onclick="deleteSavings(${goal.id})">üóëÔ∏è</button>
                            </div>
                            <div class="savings-progress">
                                <div class="progress-info">
                                    <span>R$ ${goal.current.toFixed(2)} / R$ ${goal.target.toFixed(2)}</span>
                                    <span style="color: ${statusColor}">${percentage.toFixed(1)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: ${statusColor}"></div>
                                </div>
                            </div>
                            <div class="savings-actions">
                                <div class="contribution-form">
                                    <input type="number" placeholder="Valor para adicionar" step="0.01" min="0" id="contribution-${goal.id}">
                                    <button class="btn-small contribution-btn" onclick="addContribution(${goal.id})">üí∞ Adicionar</button>
                                    <button class="btn-small withdraw-btn" onclick="withdrawFromSavings(${goal.id})">üí∏ Retirar</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
        }
        
        // Adicionar contribui√ß√£o
        function addContribution(goalId) {
            const input = document.getElementById(`contribution-${goalId}`);
            const amount = parseFloat(input.value);
            
            if (!amount || amount <= 0) {
                alert('Digite um valor v√°lido!');
                return;
            }
            
            const goal = savingsGoals.find(g => g.id === goalId);
            if (goal) {
                goal.current += amount;
                goal.contributionHistory.push({
                    amount,
                    date: new Date().toISOString(),
                    type: 'contribution'
                });
                
                saveSavingsGoals();
                updateSavingsCards();
                renderSavingsGoals();
                showSuccess(`R$ ${amount.toFixed(2)} adicionado √† meta!`);
            }
        }
        
        // Retirar de meta
        function withdrawFromSavings(goalId) {
            const input = document.getElementById(`contribution-${goalId}`);
            const amount = parseFloat(input.value);
            
            if (!amount || amount <= 0) {
                alert('Digite um valor v√°lido!');
                return;
            }
            
            const goal = savingsGoals.find(g => g.id === goalId);
            if (goal) {
                if (amount > goal.current) {
                    alert('Valor maior que o dispon√≠vel na meta!');
                    return;
                }
                
                goal.current -= amount;
                goal.contributionHistory.push({
                    amount: -amount,
                    date: new Date().toISOString(),
                    type: 'withdrawal'
                });
                
                saveSavingsGoals();
                updateSavingsCards();
                renderSavingsGoals();
                showSuccess(`R$ ${amount.toFixed(2)} retirado da meta!`);
            }
        }
        
        // Excluir meta
        function deleteSavings(id) {
            if (confirm('Tem certeza que deseja excluir esta meta?')) {
                savingsGoals = savingsGoals.filter(g => g.id !== id);
                saveSavingsGoals();
                updateSavingsCards();
                renderSavingsGoals();
            }
        }
        
        // Obter √≠cone da categoria de savings
        function getSavingsCategoryIcon(category) {
            const icons = {
                'emergencia': 'üö®',
                'viagem': '‚úàÔ∏è',
                'imovel': 'üè†',
                'educacao': 'üìö',
                'investimento': 'üìà',
                'lazer': 'üéØ',
                'outros': 'üì¶'
            };
            return icons[category] || 'üì¶';
        }
        
        // Atualizar gr√°ficos
        function updateCharts() {
            // Gr√°fico de evolu√ß√£o mensal
            const evolutionCtx = document.getElementById('evolution-chart');
            if (evolutionCtx) {
                const monthlyData = getMonthlyData();
                let chartLabels = [];
                let incomeData = [];
                let expenseData = [];
                
                if (generalMonthFilter) {
                    // M√™s espec√≠fico - mostrar evolu√ß√£o di√°ria acumulada
                    const [year, month] = generalMonthFilter.split('-');
                    const monthTransactions = transactions.filter(t => {
                        const [tYear, tMonth] = t.date.split('-');
                        return parseInt(tYear) === parseInt(year) && parseInt(tMonth) === parseInt(month);
                    });
                    
                    // Agrupar transa√ß√µes por dia
                    const dailyData = {};
                    monthTransactions.forEach(transaction => {
                        if (!dailyData[transaction.date]) {
                            dailyData[transaction.date] = { income: 0, expense: 0 };
                        }
                        if (transaction.type === 'income') {
                            dailyData[transaction.date].income += transaction.amount;
                        } else {
                            dailyData[transaction.date].expense += transaction.amount;
                        }
                    });
                    
                    // Obter todos os dias do m√™s e calcular acumulado
                    const daysInMonth = new Date(parseInt(year), parseInt(month), 0).getDate();
                    let accumulatedIncome = 0;
                    let accumulatedExpense = 0;
                    
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        chartLabels.push(String(day).padStart(2, '0'));
                        
                        if (dailyData[dateStr]) {
                            accumulatedIncome += dailyData[dateStr].income;
                            accumulatedExpense += dailyData[dateStr].expense;
                        }
                        
                        incomeData.push(accumulatedIncome);
                        expenseData.push(accumulatedExpense);
                    }
                } else {
                    // Todos os meses - mostrar √∫ltimos 6 meses
                    let labels = Object.keys(monthlyData).sort().slice(-6);
                    
                    chartLabels = labels.map(date => {
                        const [year, month] = date.split('-');
                        const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                        return `${monthNames[parseInt(month) - 1]}/${year.slice(2)}`;
                    });
                    incomeData = labels.map(date => monthlyData[date].income);
                    expenseData = labels.map(date => monthlyData[date].expense);
                }
                
                if (charts.evolution) charts.evolution.destroy();
                
                charts.evolution = new Chart(evolutionCtx, {
                    type: 'line',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: generalMonthFilter ? 'Ganhos Acumulados' : 'Ganhos',
                            data: incomeData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.2
                        }, {
                            label: generalMonthFilter ? 'Gastos Acumulados' : 'Gastos',
                            data: expenseData,
                            borderColor: '#f5576c',
                            backgroundColor: 'rgba(245, 87, 108, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            tooltip: {
                                callbacks: {
                                    afterLabel: function(context) {
                                        if (generalMonthFilter) {
                                            const dayIncome = incomeData[context.dataIndex];
                                            const dayExpense = expenseData[context.dataIndex];
                                            const balance = dayIncome - dayExpense;
                                            return [
                                                `Saldo acumulado: R$ ${balance.toFixed(2)}`,
                                                `Dia ${context.label} do m√™s`
                                            ];
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toFixed(0);
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de categorias de ganhos
            const incomeCategoryCtx = document.getElementById('income-category-chart');
            if (incomeCategoryCtx) {
                const categoryData = getCategoryData('income');
                
                if (charts.incomeCategory) charts.incomeCategory.destroy();
                
                // Verificar se h√° dados
                if (Object.keys(categoryData).length === 0) {
                    // Mostrar mensagem quando n√£o h√° dados
                    charts.incomeCategory = new Chart(incomeCategoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Sem dados'],
                            datasets: [{
                                data: [1],
                                backgroundColor: ['#e0e0e0'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    enabled: false
                                }
                            },
                            cutout: '70%'
                        }
                    });
                    
                    // Adicionar texto no centro
                    const canvas = incomeCategoryCtx;
                    const ctx = canvas.getContext('2d');
                    ctx.font = '14px sans-serif';
                    ctx.fillStyle = '#999';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('Nenhum ganho registrado', canvas.width / 2, canvas.height / 2);
                } else {
                    charts.incomeCategory = new Chart(incomeCategoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(categoryData).map(cat => getCategoryName(cat)),
                            datasets: [{
                                data: Object.values(categoryData),
                                backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#6b7280']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            }
            
            // Gr√°fico de categorias de gastos
            const expenseCategoryCtx = document.getElementById('expense-category-chart');
            if (expenseCategoryCtx) {
                const categoryData = getCategoryData('expense');
                
                if (charts.expenseCategory) charts.expenseCategory.destroy();
                
                // Verificar se h√° dados
                if (Object.keys(categoryData).length === 0) {
                    // Mostrar mensagem quando n√£o h√° dados
                    charts.expenseCategory = new Chart(expenseCategoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Sem dados'],
                            datasets: [{
                                data: [1],
                                backgroundColor: ['#e0e0e0'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    enabled: false
                                }
                            },
                            cutout: '70%'
                        }
                    });
                    
                    // Adicionar texto no centro
                    const canvas = expenseCategoryCtx;
                    const ctx = canvas.getContext('2d');
                    ctx.font = '14px sans-serif';
                    ctx.fillStyle = '#999';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('Nenhum gasto registrado', canvas.width / 2, canvas.height / 2);
                } else {
                    charts.expenseCategory = new Chart(expenseCategoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(categoryData).map(cat => getCategoryName(cat)),
                            datasets: [{
                                data: Object.values(categoryData),
                                backgroundColor: ['#f5576c', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#fd79a8', '#00b894']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            }
            
            // Gr√°fico de fluxo financeiro
            const cashflowCtx = document.getElementById('cashflow-chart');
            if (cashflowCtx) {
                const monthlyData = getMonthlyData();
                const labels = Object.keys(monthlyData).sort().slice(-6);
                const cashflow = labels.map(date => monthlyData[date].income - monthlyData[date].expense);
                
                if (charts.cashflow) charts.cashflow.destroy();
                
                charts.cashflow = new Chart(cashflowCtx, {
                    type: 'bar',
                    data: {
                        labels: labels.map(date => {
                            const [year, month] = date.split('-');
                            const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                            return `${monthNames[parseInt(month) - 1]}/${year.slice(2)}`;
                        }),
                        datasets: [{
                            label: 'Fluxo Financeiro',
                            data: cashflow.map(value => value === 0 ? Math.max(...cashflow.map(Math.abs), 1) * 0.03 : value),
                            backgroundColor: cashflow.map(value => value === 0 ? '#d1d5db' : (value >= 0 ? '#10b981' : '#f5576c'))
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const originalValue = cashflow[context.dataIndex];
                                        if (originalValue === 0) {
                                            return 'Fluxo Financeiro: R$ 0.00 (equilibrado)';
                                        }
                                        return `Fluxo Financeiro: R$ ${originalValue.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    drawBorder: true,
                                    color: function(context) {
                                        if (context.tick.value === 0) {
                                            return '#6b7280';
                                        }
                                        return '#e5e7eb';
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toFixed(0);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Obter dados mensais
        function getMonthlyData() {
            const monthly = {};
            
            // Aplicar filtro geral se houver
            let filteredTransactions = transactions;
            if (generalMonthFilter) {
                const [year, month] = generalMonthFilter.split('-');
                filteredTransactions = transactions.filter(t => {
                    const date = new Date(t.date);
                    return date.getFullYear() === parseInt(year) && 
                           date.getMonth() + 1 === parseInt(month);
                });
            }
            
            filteredTransactions.forEach(transaction => {
                const [year, month, day] = transaction.date.split('-');
                const monthKey = `${year}-${String(month).padStart(2, '0')}`;
                
                if (!monthly[monthKey]) {
                    monthly[monthKey] = { income: 0, expense: 0 };
                }
                
                if (transaction.type === 'income') {
                    monthly[monthKey].income += transaction.amount;
                } else {
                    monthly[monthKey].expense += transaction.amount;
                }
            });
            
            return monthly;
        }
        
        // Obter dados por categoria
        function getCategoryData(type) {
            const categoryData = {};
            
            // Aplicar filtro geral se houver
            let filteredTransactions = transactions;
            if (generalMonthFilter) {
                const [year, month] = generalMonthFilter.split('-');
                filteredTransactions = transactions.filter(t => {
                    const [tYear, tMonth] = t.date.split('-');
                    return parseInt(tYear) === parseInt(year) && 
                           parseInt(tMonth) === parseInt(month);
                });
            }
            
            filteredTransactions
                .filter(t => t.type === type)
                .forEach(transaction => {
                    if (!categoryData[transaction.category]) {
                        categoryData[transaction.category] = 0;
                    }
                    categoryData[transaction.category] += transaction.amount;
                });
            
            return categoryData;
        }
        
        // Obter nome da categoria
        function getCategoryName(category) {
            const names = {
                'salario': 'Sal√°rio',
                'freelancer': 'Freelancer',
                'investimento': 'Investimento',
                'extra': 'Extra',
                'outros': 'Outros',
                'alimentacao': 'Alimenta√ß√£o',
                'moradia': 'Moradia',
                'transporte': 'Transporte',
                'saude': 'Sa√∫de',
                'educacao': 'Educa√ß√£o',
                'lazer': 'Lazer e Cultura',
                'extras': 'Gastos Extras',
                'cartao': 'Gastos com Cart√£o'
            };
            return names[category] || 'Outros';
        }
        
        // Mostrar feedback de sucesso
        function showSuccess(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }
        
        // Adicionar anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        
        // Sistema de Backup e Sincroniza√ß√£o
        class BackupSystem {
            constructor() {
                this.primaryFile = 'financeiro_data_primary.json';
                this.secondaryFile = 'financeiro_data_secondary.json';
                this.lastSync = localStorage.getItem('lastSync') || 0;
                this.syncInterval = 30000; // 30 segundos
                this.init();
            }
            
            init() {
                // Carregar dados dos backups ao iniciar
                this.loadFromBackup();
                
                // Iniciar sincroniza√ß√£o peri√≥dica
                setInterval(() => this.sync(), this.syncInterval);
                
                // Salvar sempre que houver altera√ß√£o
                this.setupAutoSave();
            }
            
            async createBackup() {
                const data = {
                    transactions: transactions,
                    savingsGoals: savingsGoals,
                    timestamp: new Date().toISOString(),
                    version: Date.now()
                };
                
                // Salvar nos dois arquivos
                await this.saveToFile(data, this.primaryFile);
                await this.saveToFile(data, this.secondaryFile);
                
                this.lastSync = Date.now();
                localStorage.setItem('lastSync', this.lastSync);
            }
            
            async saveToFile(data, filename) {
                try {
                    const blob = new Blob([JSON.stringify(data, null, 2)], {
                        type: 'application/json'
                    });
                    
                    // Criar link de download autom√°tico
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    console.log(`‚úÖ Backup salvo: ${filename}`);
                } catch (error) {
                    console.error(`‚ùå Erro ao salvar ${filename}:`, error);
                }
            }
            
            async loadFromBackup() {
                try {
                    // Tentar carregar do arquivo prim√°rio
                    const primaryData = await this.loadFile(this.primaryFile);
                    
                    if (primaryData) {
                        this.mergeData(primaryData);
                        console.log('‚úÖ Dados carregados do backup prim√°rio');
                        return;
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è Falha ao carregar backup prim√°rio, tentando secund√°rio...');
                }
                
                try {
                    // Tentar carregar do arquivo secund√°rio
                    const secondaryData = await this.loadFile(this.secondaryFile);
                    
                    if (secondaryData) {
                        this.mergeData(secondaryData);
                        console.log('‚úÖ Dados carregados do backup secund√°rio');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è Falha ao carregar backup secund√°rio');
                }
            }
            
            async loadFile(filename) {
                return new Promise((resolve) => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    input.style.display = 'none';
                    
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file && file.name === filename) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                try {
                                    const data = JSON.parse(e.target.result);
                                    resolve(data);
                                } catch (error) {
                                    resolve(null);
                                }
                            };
                            reader.readAsText(file);
                        } else {
                            resolve(null);
                        }
                        document.body.removeChild(input);
                    };
                    
                    input.oncancel = () => {
                        document.body.removeChild(input);
                        resolve(null);
                    };
                    
                    document.body.appendChild(input);
                    input.click();
                });
            }
            
            mergeData(backupData) {
                if (!backupData || !backupData.version) return;
                
                const currentVersion = this.lastSync;
                
                // Se o backup for mais recente, usar dados do backup
                if (backupData.version > currentVersion) {
                    // Mesclar transa√ß√µes
                    if (backupData.transactions && Array.isArray(backupData.transactions)) {
                        const mergedTransactions = this.mergeArrays(transactions, backupData.transactions, 'id');
                        transactions = mergedTransactions;
                    }
                    
                    // Mescular metas de savings
                    if (backupData.savingsGoals && Array.isArray(backupData.savingsGoals)) {
                        const mergedSavings = this.mergeArrays(savingsGoals, backupData.savingsGoals, 'id');
                        savingsGoals = mergedSavings;
                    }
                    
                    // Atualizar localStorage
                    saveTransactions();
                    saveSavingsGoals();
                    
                    // Atualizar interface
                    updateBalanceCards();
                    updateSavingsCards();
                    renderTransactions();
                    renderSavingsGoals();
                    updateCharts();
                    
                    showSuccess('üì• Dados sincronizados com sucesso!');
                    console.log(`üì• Dados sincronizados (v${backupData.version})`);
                }
            }
            
            mergeArrays(current, backup, keyField) {
                const merged = [...current];
                const existingKeys = new Set(current.map(item => item[keyField]));
                
                // Adicionar itens do backup que n√£o existem ou s√£o mais recentes
                backup.forEach(backupItem => {
                    const existingIndex = merged.findIndex(item => item[keyField] === backupItem[keyField]);
                    
                    if (existingIndex === -1) {
                        // Item n√£o existe, adicionar
                        merged.push(backupItem);
                    } else {
                        // Item existe, verificar qual √© mais recente
                        const currentItem = merged[existingIndex];
                        const currentVersion = currentItem.version || currentItem.timestamp || 0;
                        const backupVersion = backupItem.version || backupItem.timestamp || 0;
                        
                        if (backupVersion > currentVersion) {
                            merged[existingIndex] = backupItem;
                        }
                    }
                });
                
                return merged;
            }
            
            async sync() {
                const now = Date.now();
                
                // Se passou tempo suficiente desde a √∫ltima sincroniza√ß√£o
                if (now - this.lastSync > this.syncInterval) {
                    console.log('üîÑ Iniciando sincroniza√ß√£o...');
                    await this.createBackup();
                }
            }
            
            setupAutoSave() {
                // Sobrescrever fun√ß√µes de save para incluir backup
                const originalSaveTransactions = window.saveTransactions;
                const originalSaveSavingsGoals = window.saveSavingsGoals;
                
                window.saveTransactions = function() {
                    originalSaveTransactions();
                    backupSystem.createBackup();
                };
                
                window.saveSavingsGoals = function() {
                    originalSaveSavingsGoals();
                    backupSystem.createBackup();
                };
            }
            
            // M√©todo p√∫blico para download manual
            async downloadBackup() {
                const data = {
                    transactions: transactions,
                    savingsGoals: savingsGoals,
                    timestamp: new Date().toISOString(),
                    version: Date.now()
                };
                
                const filename = `financeiro_backup_${new Date().toISOString().split('T')[0]}.json`;
                await this.saveToFile(data, filename);
                showSuccess('üíæ Backup baixado com sucesso!');
            }
            
            // M√©todo p√∫blico para upload manual
            async restoreBackup() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            const text = await file.text();
                            const data = JSON.parse(text);
                            
                            if (data.transactions && data.savingsGoals) {
                                this.mergeData(data);
                                await this.createBackup();
                                showSuccess('üì§ Backup restaurado com sucesso!');
                            } else {
                                alert('Formato de backup inv√°lido!');
                            }
                        } catch (error) {
                            alert('Erro ao ler arquivo de backup!');
                            console.error(error);
                        }
                    }
                };
                
                input.click();
            }
        }
        
        // Instanciar sistema de backup
        let backupSystem;
        
        // Inicializar quando carregar
        document.addEventListener('DOMContentLoaded', function() {
            init();
            
            // Inicializar sistema de backup
            backupSystem = new BackupSystem();
            
            // Aguardar um pouco e popular os filtros
            setTimeout(() => {
                populateMonthFilters();
            }, 100);
        });
    </script>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>